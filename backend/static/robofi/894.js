"use strict";(self.webpackChunkrobofi=self.webpackChunkrobofi||[]).push([[894],{5894:(y,l,a)=>{a.r(l),a.d(l,{WorkflowModule:()=>T});var h=a(8583),u=a(9445),c=a(5145),t=a(8186);class d{constructor(i,e){this.x=i,this.y=e}static fromEvent(i){return i instanceof MouseEvent?new d(i.clientX,i.clientY):new d(i.changedTouches[0].clientX,i.changedTouches[0].clientY)}static isIPosition(i){return!!i&&"x"in i&&"y"in i}add(i){return this.x+=i.x,this.y+=i.y,this}subtract(i){return this.x-=i.x,this.y-=i.y,this}reset(){return this.x=0,this.y=0,this}set(i){return this.x=i.x,this.y=i.y,this}}let f=(()=>{class s{constructor(e,n){this.el=e,this.renderer=n,this.allowDrag=!0,this.moving=!1,this.orignal={},this.oldTrans=new d(0,0),this.tempTrans=new d(0,0),this.oldZIndex="",this.oldPosition="",this._zIndex="",this.needTransform=!1,this.started=new t.vpe,this.stopped=new t.vpe,this.edge=new t.vpe,this.outOfBounds={top:!1,right:!1,bottom:!1,left:!1},this.gridSize=1,this.inBounds=!1,this.trackPosition=!0,this.scale=1,this.preventDefaultEvent=!1,this.position={x:0,y:0},this.movingOffset=new t.vpe,this.endOffset=new t.vpe}set zIndex(e){this.renderer.setStyle(this.el.nativeElement,"z-index",e),this._zIndex=e}set ngDraggable(e){if(null!=e&&""!==e){this.allowDrag=!!e;const n=this.handle?this.handle:this.el.nativeElement;this.allowDrag?this.renderer.addClass(n,"ng-draggable"):this.renderer.removeClass(n,"ng-draggable")}}ngOnInit(){this.allowDrag&&this.renderer.addClass(this.handle?this.handle:this.el.nativeElement,"ng-draggable"),this.resetPosition()}ngOnChanges(e){if(e.position&&!e.position.isFirstChange()){const n=e.position.currentValue;this.moving?this.needTransform=!0:(d.isIPosition(n)?this.oldTrans.set(n):this.oldTrans.reset(),this.transform())}}resetPosition(){d.isIPosition(this.position)?this.oldTrans.set(this.position):this.oldTrans.reset(),this.tempTrans.reset(),this.transform()}moveTo(e){this.orignal&&(e.subtract(this.orignal),this.tempTrans.set(e),this.transform(),this.bounds&&this.edge.emit(this.boundsCheck()),this.movingOffset.emit({x:this.tempTrans.x+this.oldTrans.x,y:this.tempTrans.y+this.oldTrans.y}))}transform(){let e=this.tempTrans.x+this.oldTrans.x,n=this.tempTrans.y+this.oldTrans.y;this.gridSize>1&&(e=Math.round(e/this.gridSize)*this.gridSize,n=Math.round(n/this.gridSize)*this.gridSize);let o=`translate(${e}px, ${n}px)`;1!==this.scale&&(o+=` scale(${this.scale})`),this.renderer.setStyle(this.el.nativeElement,"transform",o),this.renderer.setStyle(this.el.nativeElement,"-webkit-transform",o),this.renderer.setStyle(this.el.nativeElement,"-ms-transform",o),this.renderer.setStyle(this.el.nativeElement,"-moz-transform",o),this.renderer.setStyle(this.el.nativeElement,"-o-transform",o)}pickUp(){this.oldZIndex=this.el.nativeElement.style.zIndex?this.el.nativeElement.style.zIndex:"",window&&(this.oldZIndex=window.getComputedStyle(this.el.nativeElement,null).getPropertyValue("z-index")),this.zIndexMoving&&this.renderer.setStyle(this.el.nativeElement,"z-index",this.zIndexMoving),this.moving||(this.started.emit(this.el.nativeElement),this.moving=!0)}boundsCheck(){if(this.bounds){const e=this.bounds.getBoundingClientRect(),n=this.el.nativeElement.getBoundingClientRect(),o={top:!!this.outOfBounds.top||e.top<n.top,right:!!this.outOfBounds.right||e.right>n.right,bottom:!!this.outOfBounds.bottom||e.bottom>n.bottom,left:!!this.outOfBounds.left||e.left<n.left};return this.inBounds&&(o.top||(this.tempTrans.y-=n.top-e.top),o.bottom||(this.tempTrans.y-=n.bottom-e.bottom),o.right||(this.tempTrans.x-=n.right-e.right),o.left||(this.tempTrans.x-=n.left-e.left),this.transform()),o}}putBack(){this._zIndex?this.renderer.setStyle(this.el.nativeElement,"z-index",this._zIndex):this.zIndexMoving&&(this.oldZIndex?this.renderer.setStyle(this.el.nativeElement,"z-index",this.oldZIndex):this.el.nativeElement.style.removeProperty("z-index")),this.moving&&(this.stopped.emit(this.el.nativeElement),this.needTransform&&(d.isIPosition(this.position)?this.oldTrans.set(this.position):this.oldTrans.reset(),this.transform(),this.needTransform=!1),this.bounds&&this.edge.emit(this.boundsCheck()),this.moving=!1,this.endOffset.emit({x:this.tempTrans.x+this.oldTrans.x,y:this.tempTrans.y+this.oldTrans.y}),this.trackPosition&&this.oldTrans.add(this.tempTrans),this.tempTrans.reset(),this.trackPosition||this.transform())}checkHandleTarget(e,n){if("BUTTON"===n.tagName)return!1;if(n===e)return!0;for(const o in n.children)if(n.children.hasOwnProperty(o)&&this.checkHandleTarget(e,n.children[o]))return!0;return!1}onMouseDown(e){e instanceof MouseEvent&&2===e.button||void 0!==this.handle&&!this.checkHandleTarget(e.srcElement,this.handle)||(this.preventDefaultEvent&&(e.stopPropagation(),e.preventDefault()),this.orignal=d.fromEvent(e),this.pickUp())}onMouseLeave(){this.putBack()}onMouseMove(e){this.moving&&this.allowDrag&&(this.preventDefaultEvent&&(e.stopPropagation(),e.preventDefault()),this.moveTo(d.fromEvent(e)))}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(t.SBq),t.Y36(t.Qsj))},s.\u0275dir=t.lG2({type:s,selectors:[["","appDraggable",""]],hostBindings:function(e,n){1&e&&t.NdJ("mousedown",function(r){return n.onMouseDown(r)})("touchstart",function(r){return n.onMouseDown(r)})("mouseup",function(){return n.onMouseLeave()},!1,t.evT)("mouseleave",function(){return n.onMouseLeave()},!1,t.evT)("touchend",function(){return n.onMouseLeave()},!1,t.evT)("touchcancel",function(){return n.onMouseLeave()},!1,t.evT)("mousemove",function(r){return n.onMouseMove(r)},!1,t.evT)("touchmove",function(r){return n.onMouseMove(r)},!1,t.evT)},inputs:{handle:"handle",bounds:"bounds",outOfBounds:"outOfBounds",gridSize:"gridSize",zIndexMoving:"zIndexMoving",zIndex:"zIndex",inBounds:"inBounds",trackPosition:"trackPosition",scale:"scale",preventDefaultEvent:"preventDefaultEvent",position:"position",ngDraggable:"ngDraggable"},outputs:{started:"started",stopped:"stopped",edge:"edge",movingOffset:"movingOffset",endOffset:"endOffset"},exportAs:["appDraggable"],features:[t.TTD]}),s})();const m=["nodeView"],p=function(s,i){return{x:s,y:i}};function g(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"div",1,2),t.NdJ("movingOffset",function(o){return t.CHM(e),t.oxw().onMove(o)})("stopped",function(o){return t.CHM(e),t.oxw().onRelease(o)}),t.TgZ(2,"span",3),t.NdJ("mousedown",function(o){return t.CHM(e),t.oxw().connectorSelected(o)})("mouseup",function(o){return t.CHM(e),t.oxw().connectorReleased(o)}),t.qZA(),t.TgZ(3,"span",4),t.NdJ("mousedown",function(o){return t.CHM(e),t.oxw().connectorSelected(o)})("mouseup",function(o){return t.CHM(e),t.oxw().connectorReleased(o)}),t.qZA(),t.TgZ(4,"span",5),t.NdJ("mousedown",function(o){return t.CHM(e),t.oxw().connectorSelected(o)})("mouseup",function(o){return t.CHM(e),t.oxw().connectorReleased(o)}),t.qZA(),t.TgZ(5,"span",6),t.NdJ("mousedown",function(o){return t.CHM(e),t.oxw().connectorSelected(o)})("mouseup",function(o){return t.CHM(e),t.oxw().connectorReleased(o)}),t.qZA(),t.TgZ(6,"div",7,8),t._uU(8),t.qZA(),t.TgZ(9,"div",9),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return o.workflow.deleteNode(o.node)}),t._uU(10,"\u2715"),t.qZA(),t.qZA()}if(2&s){const e=t.MAs(7),n=t.oxw();t.Q6J("id",n.node.id)("inBounds",!0)("bounds",n.container)("position",t.WLB(6,p,n.xOffset,n.yOffset))("handle",e),t.xp6(8),t.hij(" ",n.node.title," ")}}let v=(()=>{class s{constructor(){this.xOffset=0,this.yOffset=0,this.gridSize=1}ngOnInit(){this.xOffset=this.node.x||0,this.yOffset=this.node.y||0}onMove(e){this.workflow.draggable&&(this.node.x=e.x,this.node.y=e.y)}onRelease(e){if(this.workflow.draggable){const o=this.node.y?this.node.y:0;this.node.x=Math.floor((this.node.x?this.node.x:0)/this.gridSize)*this.gridSize,this.node.y=Math.floor(o/this.gridSize)*this.gridSize}}connectorSelected(e){this.workflow.startCreatingConnection(this.sideOf(e.target),this.node)}connectorReleased(e){this.workflow.finishCreatingConnection(this.sideOf(e.target),this.node)}sideOf(e){const n=Array.from(e.classList).find(o=>0===o.toString().indexOf("connector-"));if(n){const o=n.toString().replace("connector-","");if(["top","left","right","bottom"].indexOf(o)>=0)return o}}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-node"]],viewQuery:function(e,n){if(1&e&&t.Gf(m,5),2&e){let o;t.iGM(o=t.CRH())&&(n.nodeViewRef=o.first)}},inputs:{gridSize:"gridSize",container:"container",node:"node",workflow:"workflow"},decls:1,vars:1,consts:[["class","node","appDraggable","",3,"id","inBounds","top","left","bounds","position","handle","movingOffset","stopped",4,"ngIf"],["appDraggable","",1,"node",3,"id","inBounds","top","left","bounds","position","handle","movingOffset","stopped"],["nodeView",""],[1,"connector","connector-left",3,"mousedown","mouseup"],[1,"connector","connector-bottom",3,"mousedown","mouseup"],[1,"connector","connector-top",3,"mousedown","mouseup"],[1,"connector","connector-right",3,"mousedown","mouseup"],[1,"node-content"],["dragHandle",""],[1,"workflow-cross",3,"click"]],template:function(e,n){1&e&&t.YNc(0,g,11,9,"div",0),2&e&&t.Q6J("ngIf",n.node&&n.workflow)},directives:[h.O5,f],styles:[""]}),s})();const x=[{path:"",redirectTo:c.x.config.workflow.editor,data:{title:"Editor",robots:"noindex, nofollow"}},{path:"editor",component:(()=>{class s{constructor(){}ngOnInit(){}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-editor"]],decls:1,vars:0,template:function(e,n){1&e&&t._UZ(0,"app-node")},directives:[v],styles:[""]}),s})(),data:{title:"Editor",robots:"noindex, nofollow"}}];let w=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[[u.Bz.forChild(x)],u.Bz]}),s})(),T=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[[h.ez,w]]}),s})()}}]);